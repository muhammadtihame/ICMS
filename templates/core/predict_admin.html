{% extends 'base.html' %}
{% load i18n %}
{% block title %}{% trans 'Predict Performance' %} | LMS{% endblock title %}
{% block content %}
<div class="card p-3">
  <h5 class="mb-3">{% trans 'Predict Performance (Admin/Teacher)' %}</h5>
  <div class="input-group mb-2">
    <input id="pp-name" type="text" class="form-control" placeholder="Enter student name or ID..." />
    <button id="pp-run" class="btn btn-primary">{% trans 'Predict' %}</button>
  </div>
  <div id="pp-result" class="mt-3"></div>
</div>

<script>
function getCookie(name){
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return parts.pop().split(';').shift();
}
document.getElementById('pp-run').addEventListener('click', async () => {
  const name = document.getElementById('pp-name').value.trim();
  if (!name) { alert('Enter a student name'); return; }
  const form = new FormData();
  form.append('student_name', name);
  const res = await fetch('{% url "predict_api" %}', {
    method: 'POST',
    body: form,
    headers: { 'X-CSRFToken': getCookie('csrftoken') }
  });
  const data = await res.json();
  const el = document.getElementById('pp-result');
  if (!res.ok) { el.innerHTML = `<div class="text-danger">${data.error || 'Error'}</div>`; return; }
  el.innerHTML = `<b>Student:</b> ${data.student} (${data.username})<br/><b>Category:</b> ${data.category}<br/><b>Predicted marks:</b> ${data.predicted_marks.toFixed ? data.predicted_marks.toFixed(2) : data.predicted_marks}`;
});
</script>
{% endblock content %}


